(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fad4a5a4"],{b637:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app"},[s("el-row",{attrs:{gutter:10}},[s("el-col",[s("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v(" "+e._s(e.actives[e.active_index].name)+" ")]),s("div",{staticStyle:{display:"inline"},on:{click:function(t){return e.task_switch_put()}}},[s("el-switch",{staticStyle:{float:"right",padding:"3px 0"},attrs:{disabled:e.is_switch,"active-text":"开启","inactive-text":"关闭"},model:{value:e.actives[e.active_index].is_open,callback:function(t){e.$set(e.actives[e.active_index],"is_open",t)},expression:"actives[active_index].is_open"}})],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.actives[e.active_index].is_open,expression:"actives[active_index].is_open"}],staticClass:"text item"},[s("el-button",{on:{click:function(t){e.dialogVisible_roster_box=!0}}},[e._v("排班")]),s("el-button",{on:{click:function(t){return e.flush()}}},[e._v(" 重置任务")]),s("el-button",{on:{click:function(t){return e.get_condition()}}},[e._v("记录情况")]),s("a",{attrs:{href:e.excel_url,target:"_Blank"}},[s("el-button",[e._v("导出Excel ")])],1)],1)])],1)],1),s("br"),s("el-dialog",{attrs:{title:"排班",visible:e.dialogVisible_roster_box,width:"90%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible_roster_box=t}}},[e._l(e.roster,(function(t,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:e.actives[e.active_index].is_open,expression:"actives[active_index].is_open"}],key:i,staticClass:"roster_box"},[s("h3",[e._v(e._s(t.title))]),e._l(t.layer_list,(function(t,i){return s("div",{key:i,staticClass:"layer"},[s("h4",[e._v(e._s(t.title))]),e._l(t.user,(function(i,a){return s("div",{key:a,staticClass:"layer"},[e._v(" "+e._s(i.username)+" "+e._s(i.name)+" "+e._s(i.tel)+" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.is_show_button,expression:"is_show_button"}],attrs:{size:"mini",icon:"el-icon-close"},on:{click:function(s){return e.remove_user(t,a)}}})],1)})),s("div",{directives:[{name:"show",rawName:"v-show",value:e.is_show_button,expression:"is_show_button"}],staticClass:"search_box"},[s("el-row",{attrs:{gutter:10}},[s("el-col",{attrs:{xs:24,md:8}},[s("el-input",{attrs:{size:"small",placeholder:"学号"},model:{value:t.user_object.username,callback:function(s){e.$set(t.user_object,"username",s)},expression:"layer.user_object.username"}})],1),s("el-col",{attrs:{xs:24,md:8}},[s("el-input",{attrs:{size:"small",placeholder:"姓名"},model:{value:t.user_object.name,callback:function(s){e.$set(t.user_object,"name",s)},expression:"layer.user_object.name"}})],1),s("el-col",{attrs:{xs:24,md:8}},[s("el-input",{attrs:{size:"small",placeholder:"电话"},model:{value:t.user_object.tel,callback:function(s){e.$set(t.user_object,"tel",s)},expression:"layer.user_object.tel"}})],1)],1)],1),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.is_show_button,expression:"is_show_button"}],attrs:{size:"small",icon:"el-icon-search"},on:{click:function(s){return e.search_user(t)}}},[e._v("搜索")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.is_show_button,expression:"is_show_button"}],attrs:{size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(s){return e.add_user(t)}}},[e._v("添加")])],2)}))],2)})),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible_roster_box=!1}}},[e._v("取 消")]),s("el-button",{on:{click:function(t){return e.simple_information()}}},[e._v("查看/修改")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save_roster()}}},[e._v("保存")])],1)],2),s("br"),s("el-row",[s("el-col",{attrs:{sm:24}},[s("el-card",{directives:[{name:"show",rawName:"v-show",value:e.actives[e.active_index].is_open,expression:"actives[active_index].is_open"}],attrs:{shadow:"hover"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("查寝记录")])]),s("div",{staticClass:"user_list"},e._l(e.tableData,(function(t){return s("el-popover",{key:t.id,staticStyle:{"margin-right":"10px"},attrs:{trigger:"hover",placement:"top",width:"160"}},[s("p",[e._v("寝室："+e._s(t.room_str))]),s("p",[e._v("原因："+e._s(t.rule_str))]),s("p",[e._v("执行人："+e._s(t.worker))]),s("p",[e._v("执行时间："+e._s(t.star_time))]),s("div",{staticStyle:{"text-align":"right",margin:"0px"}},[s("el-button",{attrs:{width:"120",type:"primary"},on:{click:function(s){return e.pintle(t.index,t)}}},[e._v(" 销假")])],1),s("el-button",{attrs:{slot:"reference",type:t.flg?"":"info"},slot:"reference"},[s("span",[e._v(e._s(t.student_approved_number))]),s("br"),s("span",[e._v(e._s(t.student_approved))])])],1)})),1)])],1)],1)],1)},a=[],n=(s("ea69"),s("08ba"),{data:function(){return{is_switch:!1,excel_url:"",switc:"",actives:[{id:"",name:"加载中",is_open:!1,is_builder:!1}],active_index:0,code:"*****",tableData:[],input_list:[],user_list:[],dialogTableVisible:!0,flg:!0,formLabelWidth:"120px",username:"",roster:[{title:"1号楼",layer_list:[{title:"1-2层",user_object:{username:"",name:"",grade:"",tel:""},user:[{username:"",name:"",grade:"",tel:""}]}]}],dialogVisible_roster_box:!1,is_show_button:!1}},created:function(){var e=this;this.get_activa(),this.get_condition(),setInterval((function(){e.get_condition()}),3e4)},methods:{get_activa:function(){var e=this;this.$store.dispatch("SchoolAttendance/my_active",{type:"0"}).then((function(t){var s=t.data;e.actives=s,e.get_scheduling();var i=e.actives[e.active_index].id,a=e.$api.SchoolAttendance.out_knowing_excel_data+"?task_id="+i;e.$data.excel_url=a})).catch((function(){}))},task_switch_put:function(){var e=this;console.log("切换");var t=this.actives[this.active_index].id;this.is_switch=!0,this.$store.dispatch("SchoolAttendance/task_switch_put",{id:t}).then((function(t){e.$data.switc=t.data,e.is_switch=!1})).catch((function(t){console.log(t),e.is_switch=!1}))},flush:function(){var e=this;this.$confirm("此操作将重置当天房间被查记录、重置所有学生在寝状态为在 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=e.actives[e.active_index].id;e.$api.SchoolAttendance.task_switch_delete({task_id:t}).then((function(t){e.$message({message:t.message,type:"success"})}))})).catch((function(){e.$message({type:"info",message:"已取消"})}))},get_scheduling:function(){var e=this;this.$api.SchoolAttendance.scheduling_get({id:this.actives[this.active_index]["id"]}).then((function(t){e.roster=t.data})).catch((function(){}))},add_user:function(e){e.user.push(JSON.parse(JSON.stringify(e.user_object))),e.user_object={username:"",name:"",grade:"",tel:""}},remove_user:function(e,t){e.user.splice(t,1)},search_user:function(e){this.$api.SchoolAttendance.searchUser({username:e.user_object.username}).then((function(t){e.user_object=t.data,console.log(t.data)})).catch((function(e){console.log(e)})),clearTimeout(this.timeout),this.timeout=setTimeout((function(){}),2e3*Math.random())},save_roster:function(){var e=this;console.log(" 保存班表",this.roster);var t=this.actives[this.active_index].id;this.$api.SchoolAttendance.scheduling_post({roster:this.roster,id:t,data:""}).then((function(t){console.log(t),2e3===t.code&&(e.$message({message:t.message,type:"success"}),e.$data.dialogVisible_roster_box=!1)}))},get_condition:function(){var e=this;console.log("获取缺勤名单"),this.$data.actives[this.active_index].id&&this.$store.dispatch("SchoolAttendance/condition",{task_id:this.$data.actives[this.active_index].id}).then((function(t){t.data.forEach((function(e,t){e["flg"]=!0})),e.$data.tableData=t.data})).catch((function(){}))},pintle:function(e,t){var s=this;this.$confirm("此操作将对该同学销假,并且记录您的信息 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log("销假"),s.$api.SchoolAttendance.undo_record_delete({record_id:t.id,task_id:s.$data.actives[s.active_index].id}).then((function(e){2e3===e.code&&(s.$message({message:e.message,type:"success"}),t.flg=!1)})).catch((function(e){s.$message({type:"info",message:"失败"})}))})).catch((function(){s.$message({type:"info",message:"已取消"})}))},exportexcel:function(){var e=this;api.exportexcel().then((function(t){e.$message({message:t.message,type:"success"})}))},simple_information:function(){this.$data.is_show_button=!this.$data.is_show_button},handleClose:function(e){this.$confirm("确认关闭？").then((function(t){e()})).catch((function(e){}))}}}),o=n,c=(s("c9a0"),s("4ac2")),r=Object(c["a"])(o,i,a,!1,null,"7db08de8",null);t["default"]=r.exports},c9a0:function(e,t,s){"use strict";s("ee15")},ea69:function(e,t,s){"use strict";var i=s("1c8b"),a=s("e1d6"),n=s("3da3"),o=s("d88d"),c=s("3553"),r=s("1ca1"),l=s("1bbd"),u=s("1ea7"),d=s("ff9c"),_=u("splice"),h=d("splice",{ACCESSORS:!0,0:0,1:2}),v=Math.max,f=Math.min,p=9007199254740991,m="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!_||!h},{splice:function(e,t){var s,i,u,d,_,h,b=c(this),g=o(b.length),x=a(e,g),w=arguments.length;if(0===w?s=i=0:1===w?(s=0,i=g-x):(s=w-2,i=f(v(n(t),0),g-x)),g+s-i>p)throw TypeError(m);for(u=r(b,i),d=0;d<i;d++)_=x+d,_ in b&&l(u,d,b[_]);if(u.length=i,s<i){for(d=x;d<g-i;d++)_=d+i,h=d+s,_ in b?b[h]=b[_]:delete b[h];for(d=g;d>g-i+s;d--)delete b[d-1]}else if(s>i)for(d=g-i;d>x;d--)_=d+i-1,h=d+s-1,_ in b?b[h]=b[_]:delete b[h];for(d=0;d<s;d++)b[d+x]=arguments[d+2];return b.length=g-i+s,u}})},ee15:function(e,t,s){}}]);